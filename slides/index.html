<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Advanced JS class</title>
  
  <link rel="stylesheet" href="reveal/css/reveal.min.css">
  <link rel="stylesheet" href="reveal/lib/css/googlecode.css">

  <link rel="stylesheet" href="slides-theme/style.css">
  <link rel="stylesheet" href="slides-theme/talk-specific.css">

  <!-- demos -->

  <!-- for live coding -->
  <link rel="stylesheet" href="js/little-console.css" id="theme">

  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24335480-1']);
  _gaq.push(['_trackPageview']);

  var asyncScript = function(src) {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = src;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  };

  asyncScript(('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js');
  </script>

  <script src="js/revealHooks.js"></script>

</head>

<body>

  <div class="reveal">
    <div class="slides">
<section  class=""><h2 id="advanced-javascript">Advanced Javascript</h2>
<p>@timruffles</p>
</section>

<section  class=""><h2 id="get-setup">Get setup</h2>
<ol>
  <li >WiFi: <span contenteditable><em>edit here</em></span></li>
  <li>Clone <a href="https://www.github.com/timruffles/js-class">github.com/timruffles/js-class</a> - you need <a href="https://git-scm.com/downloads">git</a></li>
  <li>Install Node Current - <a href="https://nodejs.org">nodejs.org</a></label></li>
  <li><label><code>npm install</code></label></li>
</ol>

</section>

<section  class=""><h2 id="today">Today</h2>
<blockquote>
<p>Building strong core JS skills, ready to tackle modern JS codebases!</p>
</blockquote>
</section>

<section  class=""><h2 id="three-top-level-skills">Three top-level skills</h2>
</section>

<section  class=""><h2 id="reading-writing-core-js">Reading/writing core JS</h2>
</section>

<section  class=""><h2 id="picking-amp-reasoning-about-data-structures">Picking, &amp; reasoning, about data-structures</h2>
</section>

<section  class=""><h2 id="async-reasoning-about-the-runtime">Async: reasoning about the runtime</h2>
</section>

<section  class=""><h2 id="our-guide">Our guide</h2>
<pre><code class="lang-Javascript">// most code examples can be directly pasted
// in browser console

console.log((0, &quot;what does this do?&quot;));
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="core">Core</h2>
</section>

<section  class=""><h2 id="aim">Aim</h2>
<ul>
<li>Effective &#39;programming in the small&#39;</li>
<li>Writing JS like a native</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="challenge">Challenge</h2>
<pre><code class="lang-javascript">export function spy(spyFunction, {
    target,
    method,
}) {
    const spiedFunction = method
        ? createWrappedMethod()
        : target;

    const name = `${method || target.name}Spied`;
    const {
        [name]: wrapped,
    } = {
        [name](...args) {
            const result = spiedFunction(...args);
            spyFunction(result, ...args);
            return result;
        },
    };

    return wrapped;

    function createWrappedMethod() {
        const method = target[method];
        return (...args) =&gt; method.apply(target, args);
    }
}
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="how-variables-really-work">How variables <em>really</em> work</h2>
</section>

<section  class=""><h2 id="variables">Variables</h2>
<ul>
<li>A place for values to live</li>
<li>A way to refer (&#39;get&#39;) to values</li>
</ul>
</section>

<section  class=""><h2 id="values">Values</h2>
<ul>
<li>Primitives or objects</li>
<li>Primitives: <code>null</code>, numbers, strings</li>
<li>Objects: arrays, regex, DOM nodes, etc</li>
</ul>
</section>

<section  class=""><h2 id="let-s-declare-some-variables">Let&#39;s declare some variables</h2>
<pre><code class="lang-javascript">let a = 1;
let b;
</code></pre>
</section>

<section  class=""><h2 id="-undefined-vs-undeclared"><code>undefined</code> vs undeclared</h2>
</section>

<section  class=""><h2 id="-undefined-"><code>undefined</code></h2>
<pre><code class="lang-javascript">let notDefined;

console.log(notDefined); // ?
</code></pre>
</section>

<section  class=""><h2 id="undeclared">Undeclared</h2>
<pre><code class="lang-javascript">let someVar;

console.log(smeVar); // typo, what happens??
console.log(notHere); // and here?
</code></pre>
</section>

<section  class=""><h2 id="two-things-happened-to-variables-with-es6">Two things happened to variables with ES6</h2>
</section>

<section  class=""><h2 id="one-most-variables-are-now-constant">One: most variables are now constant</h2>
<pre><code>const aConstVariable = &quot;how weird... I&#39;m a constant variable&quot;;
</code></pre></section>

<section  class=""><h2 id="always-use-const-let-if-you-can-t">Always use <code>const</code>, <code>let</code> if you can&#39;t</h2>
<ul>
<li>97.5% of variables in Cubik were <code>const</code></li>
<li>98% of variables for Dazn are <code>const</code></li>
</ul>
</section>

<section  class=""><h2 id="only-places-to-use-let-">Only places to use <code>let</code></h2>
<ul>
<li>&#39;Library&#39;/helper code</li>
<li>Where a function has internal state</li>
<li>Old-school loops: <code>for(let i = 0</code> (after measuring performance)</li>
</ul>
</section>

<section  class=""><h2 id="-const-"><code>const</code></h2>
</section>

<section  class=""><h2 id="how-does-const-work-">How does <code>const</code> work?</h2>
<pre><code class="lang-javascript">const tasty = [&#39;ice cream&#39;, &#39;pizza&#39;];
const tastyTwo = tasty;
tasty[0] = &#39;cake&#39;;

console.log(tasty, tastyTwo);
</code></pre>
</section>

<section  class=""><h2 id="-const-is-about-assignment"><code>const</code> is about assignment</h2>
<ul>
<li>Will always refer to the same <em>value</em></li>
<li>But that value can change internally (AKA be mutated)</li>
</ul>
</section>

<section data-state='title' class=" title"><h2 id="two-variable-declarations-can-launch-rockets">Two: variable declarations can launch rockets</h2>
</section>

<section  class=""><h2 id="how-">How?</h2>
</section>

<section  class=""><h2 id="destructuring">Destructuring</h2>
</section>

<section  class=""><h2 id="expressive-way-to-work-with-structures">Expressive way to work with structures</h2>
<pre><code class="lang-javascript">const {
    data: {
        children: [
            firstStory,
            ...rest,
        ],
    }
} = await json(&#39;https://reddit.com/r/funny.json&#39;);
</code></pre>
</section>

<section  class=""><h2 id="simple-example">Simple example</h2>
<pre><code class="lang-javascript">const person = {
    name: &#39;Ada Lovelace&#39;,
    dob: new Date(&#39;1815-12-10&#39;),
};
const {
    name,
    dob
} = person;
</code></pre>
</section>

<section  class=""><h2 id="renaming">Renaming</h2>
<pre><code class="lang-javascript">const person = {
    name: &#39;Ada Lovelace&#39;,
    dob: new Date(&#39;1815-12-10&#39;),
};
const {
    // left hand side is the source property the variable
    name: nameOfPerson,
    dob: dateOfBirth,
} = person;
</code></pre>
</section>

<section  class=""><h2 id="arrays">Arrays</h2>
<pre><code class="lang-javascript">const [breakfast, lunch, ...more]
  = [&quot;eggs&quot;, &quot;falafel&quot;, &quot;high tea&quot;, &quot;a feast!&quot;, &quot;hot chocolate&quot;];

console.log(breakfast) // &quot;eggs&quot;
console.log(more) // [&quot;high tea&quot;, &quot;a feast!&quot;, &quot;hot chocolate&quot;];
</code></pre>
</section>

<section  class=""><h2 id="no-limit-">No limit!</h2>
<ul>
<li>warning: may cause colleagues to shun you</li>
</ul>
<pre><code class="lang-javascript">const party = {
  guests: [
    {
      name: &quot;Hare&quot;,
      treats: [
        &quot;chocolate eggs&quot;,
        &quot;toast&quot;,
        &quot;rich tea biscuits&quot;
      ],
    },
  ],
};
const {
    guests: [{name, treats: [best, ...rest], mood = &quot;jumpy&quot; }],
} = party;

console.log(name, rest) // &quot;Hare&quot;, [&quot;toast&quot;, &quot;rich tea biscuits&quot;]
</code></pre>
</section>

<section  class=""><h2 id="okay-but-what-about-the-rockets-">Okay, but what about the rockets?</h2>
</section>

<section  class=""><h2 id="failing">Failing</h2>
<pre><code class="lang-javascript">const notGuest = 1;
const { name, treat } = notGuest;

console.log(name, treat) // undefined, undefined
</code></pre>
</section>

<section  class=""><h2 id="default-expressions-">Default expressions!</h2>
</section>

<section  class=""><h2 id="e-g">e.g</h2>
<pre><code class="lang-javascript">const BOOM = function() {
    console.log(&#39;LIFTOFF 🚀&#39;);
};

console.log(&quot;Begin&quot;);

const rocketLaunches = [];
const [
   mostRecent = BOOM(),
   ...rest
] = rocketLaunches;

console.log(&#39;End&#39;);

// we see &#39;Begin, LIFTOFF 🚀, End&#39;
</code></pre>
</section>

<section  class=""><h2 id="what-could-we-do-with-this-">What could we do with this?</h2>
</section>

<section  class=""><h2 id="validate-structure-">Validate structure!</h2>
<pre><code class="lang-javascript">function formatPerson(person) {
    function required(property) {
        throw Error(&#39;Missing &#39; + property);
    }

    const {
        // left hand side is the source property the variable
        name: nameOfPerson = required(&#39;name&#39;),
        dob: dateOfBirth = require(&#39;dob&#39;),
    } = person;

    return {
        nameOfPerson,
        dateOfBirth,
    };
}

// Error: missing name
formatPerson({});
</code></pre>
</section>

<section  class=""><h2 id="what-s-the-idiomatic-way-of-writing-this-">What&#39;s the idiomatic way of writing this?</h2>
</section>

<section  class=""><h2 id="destructuring-in-function-arguments">Destructuring in function arguments</h2>
<pre><code class="lang-javascript">function required(property) {
    throw Error(&#39;Missing &#39; + property);
}

function formatPerson({
        // left hand side is the source property the variable
        name: nameOfPerson = required(&#39;name&#39;),
        dob: dateOfBirth = require(&#39;dob&#39;),
}) {
    return {
        nameOfPerson,
        dateOfBirth,
    };
}

// Error: missing name
formatPerson({});
</code></pre>
</section>

<section  class=""><h2 id="optionals">Optionals</h2>
<pre><code class="lang-javascript">function englishListA(words, {
    oxfordComma = false,
}) {}

function englishListB(words, {
    oxfordComma = false,
} = {}) {}

// TypeError: Cannot destructure property <code>x</code>
// of &#39;undefined&#39; or &#39;null&#39;.
englishListA([])

// OK - the default expression gives us something to destructure
englishListB([])
</code></pre>
</section>

<section  class=""><h2 id="let-s-try">Let&#39;s try</h2>
<pre><code>exercises/destructuring
</code></pre></section>

<section data-state='title' class=" title"><h2 id="demystifying-scopes">Demystifying scopes</h2>
</section>

<section  class=""><h2 id="variables-exist-in-scopes">Variables exist in scopes</h2>
<ul>
<li>Why?</li>
</ul>
</section>

<section  class=""><h2 id="understanding-scope">Understanding scope</h2>
<ul>
<li>Necessary to be confident JS coders</li>
</ul>
</section>

<section  class=""><h2 id="two-things-we-want-to-be-able-to-say">Two things we want to be able to say</h2>
<ul>
<li>&#39;a scope&#39;</li>
<li>&#39;in scope&#39;</li>
</ul>
</section>

<section  class=""><h2 id="what-is-going-on-here-">What is going on here?</h2>
<pre><code class="lang-javascript">let A = 10;

function alpha(A) {
    A = 20;
}

alpha(A);
console.log(A);
</code></pre>
</section>

<section  class=""><h2 id="-a-scope-">&#39;A scope&#39;</h2>
</section>

<section  class=""><h2 id="spot-the-scopes">Spot the scopes</h2>
<pre><code class="lang-javascript">// some-file.js
export function alpha(x) {
    if(x &gt; 5) {
        return &#39;high&#39;;
    } else {
        const msg = low(x);
        return msg;
    }

    // ...
    function low(lo) {
        return lo + &#39; was too low&#39;;
    }
}

const gamma = 1;
alpha(gamma);
</code></pre>
</section>

<section  class=""><h2 id="functions-scope">Functions &amp; scope</h2>
</section>

<section  class=""><h2 id="at-what-time-">At what time?</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="created-per-invocation">Created per invocation</h2>
<pre><code class="lang-javascript">function main(A) {
  console.log(A);
}

main(10);
main(&quot;hello &quot; + 5);
</code></pre>
</section>

<section data-state='notitle' class=" notitle"><h2 id="intuitive">Intuitive</h2>
<pre><code class="lang-javascript">function main(A) {
  console.log(A);
}

let A = 10;
main(A);
main(A + 5);
</code></pre>
</section>

<section  class=""><h2 id="global-scope-">Global scope?</h2>
</section>

<section  class=""><h2 id="module-scope">Module scope</h2>
<ul>
<li>ES6 introduced modules</li>
<li>module: file with import/export<ul>
<li>or <code>&lt;script type=&quot;module&quot;&gt;</code></li>
</ul>
</li>
<li>lifetime?</li>
<li>Modules are evaluated once</li>
</ul>
</section>

<section  class=""><h2 id="module-scoped-variables">Module scoped variables</h2>
<ul>
<li>Live forever</li>
</ul>
</section>

<section  class=""><h2 id="-in-scope-">&#39;In scope&#39;</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="more-complex">More complex</h2>
<pre><code class="lang-javascript">function main() {
  let A = &#39;hello&#39;;
  let B = &#39;hi&#39;;

  function one(A, C) {
    let D = &#39;hola&#39;;
    console.log(A,B,C,D);
  }

  one(A, &#39;yo&#39;);
  one(A);
  one(B,A);

  console.log(D); // &lt;- what happens here?
}
</code></pre>
</section>

<section  class=""><h2 id="block-scope">Block scope</h2>
<pre><code class="lang-javascript">for(let i = 0; i++; i &lt; 10) {
  console.log(i);
}

// reference error
console.log(i);
</code></pre>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-of-block-scope">Diagram of block scope</h2>
<p><img src="media/block-scopes.png"></p>
<pre><code class="lang-javascript">function main() {
  // what happens here?
  console.log(i);

  for(var i = 0; i&lt;10; i++) {
    console.log(i);
  }
}
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="using-scopes-for-expression">Using scopes for expression</h2>
</section>

<section  class=""><h2 id="organisation">Organisation</h2>
</section>

<section  class=""><h2 id="low-level-helper-functions">Low-level: helper functions</h2>
<pre><code class="lang-javascript">// makes role of first/second/third very clear: only
// used in complexProcess
function complexProcess(a,b,c) {
    const d = first(a,b);
    const e = second(c);
    return third(d,e);

    function first() { /* ... */ }
    function second() { /* ... */ }
    function third() { /* ... */ }
}
</code></pre>
</section>

<section  class=""><h2 id="high-level">High level</h2>
</section>

<section  class=""><h2 id="script-organisation">Script organisation</h2>
<pre><code class="lang-javascript">main(process.argv[2], process.env.SOME_FLAG);

function main(targetFile, flag) {
    const config = getConfig(flag);

    const result = stepOne(targetFile, config);

    console.error(notify(result));

    output(result);
}

function stepOne() {
    // ...
    veryBoringDetail();
    // ...
}

function veryBoringDetail() {}
</code></pre>
</section>

<section  class=""><h2 id="important-to-trivial">Important to trivial</h2>
<pre><code class="lang-javascript">// this file takes CLI args and does something
main(process.argv[2], process.env.SOME_FLAG);

function main(targetFile, flag) {}
function stepOne() {}

// ...
// hundreds of lines later
function veryBoringDetail() {}
</code></pre>
</section>

<section  class=""><h2 id="trivial-to-important">Trivial to important</h2>
<pre><code class="lang-javascript">const veryBoringDetail = () =&gt; {};
const anotherBoringDetail = () =&gt; {};
const stepOne = () =&gt; {}
// ...
// hundreds of lines later
const main = () =&gt; {}

// last line of the file
main(process.argv[2], process.env.SOME_FLAG);
</code></pre>
</section>

<section  class=""><h2 id="-var-"><code>var</code></h2>
</section>

<section  class=""><h2 id="still-necessary-for-js-devs">Still necessary for JS devs</h2>
<ul>
<li>Old runtimes, or weird ones: databases etc</li>
<li>Issues in transpiled code 😱</li>
</ul>
</section>

<section  class=""><h2 id="hoisting-var-">Hoisting &amp; <code>var</code></h2>
<pre><code class="lang-javascript">function main() {
  console.log(i);

  for(var i = 0; i&lt;10; i++) {
    console.log(i);
  }
}
</code></pre>
<pre><code class="lang-javascript">// visualising the &#39;hoisting zone&#39;
function main() {
  var i;
  ⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️
  console.log(i);

  for(var i = 0; i&lt;10; i++) {
    console.log(i);
  }
}
</code></pre>
</section>

<section  class=""><h2 id="global-scope">Global scope</h2>
<pre><code class="lang-javascript">// browser - strict mode
window.something = &quot;I am global&quot;;

// is now referencable anywhere in program via global scope
console.log(something);

// node
global.something = &quot;I am global&quot;;
</code></pre>
</section>

<section  class=""><h2 id="acessing-global-object">Acessing global object</h2>
<pre><code class="lang-javascript">this; // sloppy, outside functions

window; // browser
global; // node
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="pro-level-functions">Pro-level functions</h2>
<p><img src="slides-theme/img/eval-apply.jpg" style='width:476px; display:block; margin: 0 auto'></p>
</section>

<section  class=""><h2 id="three-ways-to-define">Three ways to define</h2>
</section>

<section  class=""><h2 id="declare">Declare</h2>
<pre><code class="lang-javascript">function add(a,b) {
  return a + b;
} // &lt;- no semi-colon required
</code></pre>
</section>

<section  class=""><h2 id="expression">Expression</h2>
<pre><code class="lang-javascript">const add = function(a, b) {
  return a + b;
};
</code></pre>
<ul>
<li>(expression: evaluates to a value)</li>
</ul>
</section>

<section  class=""><h2 id="fat-arrow">Fat-arrow</h2>
<pre><code class="lang-javascript">const add = (a, b) =&gt; {
    return a + b;
};
</code></pre>
</section>

<section  class=""><h2 id="why-">Why?</h2>
</section>

<section  class=""><h2 id="shorthand-for-legibility">Shorthand for legibility</h2>
<pre><code class="lang-javascript">const idsA = users.map(function (user) { return user.id });

// fat arrow, curly bracket form
const idsA = users.map((user) =&gt; { return user.id });

// drop parens for single argument
const idsB = users.map(user =&gt; { return user.id });

// bracketless form - no return, single expression
const idsB = users.map(user =&gt; user.id);
</code></pre>
</section>

<section  class=""><h2 id="rules-on-shorthands">Rules on shorthands</h2>
</section>

<section  class=""><h2 id="multiple-statements">Multiple statements</h2>
<pre><code class="lang-javascript">// note: multiple statements requires {} form
const twoStep = (a, b) =&gt; { console.log(a); return b }
</code></pre>
</section>

<section  class=""><h2 id="returning-an-object">Returning an object</h2>
<pre><code class="lang-javascript">// returning just an object requires you provide brackets
const object = (a, b) =&gt; ({a:1, b:2})
</code></pre>
<p class=fragment>
- Is a fat-arrow an expression?
</p>

</section>

<section  class=""><h2 id="destructure-in-arrow-functions">Destructure in arrow functions</h2>
<pre><code class="lang-javascript">const addCounts = ({count}, {count: countB}) =&gt; count + countB;
</code></pre>
</section>

<section  class=""><h2 id="declarations">Declarations</h2>
<ul>
<li>special</li>
<li>hoisting power!</li>
</ul>
<pre><code class="lang-javascript">main();
function main() {}
function important() {}
function fairlyImportant() {}
function boring() {}
function trivial() {}
function reallyNotThatInteresting() {}
</code></pre>
</section>

<section  class=""><h2 id="default-parameters">Default parameters</h2>
<pre><code class="lang-javascript">// default parameters
function log(n, base = 10, opts = {}) {
  // ...
}
</code></pre>
</section>

<section  class=""><h2 id="-required-parameters-trick">&#39;Required&#39; parameters trick</h2>
<pre><code class="lang-javascript">// default parameters
function log(n = required(&quot;number&quot;), base = 10) {
  // ...
}

function required(name) {
  throw new Error(name + &quot; is a required argument&quot;);
}
</code></pre>
</section>

<section  class=""><h2 id="named-parameters-via-destructuring">Named parameters via destructuring</h2>
<pre><code class="lang-javascript">function log({ n, base }) {
  return Math.log(n) / Math.log(base);
}


log({ n: 64, base: 4 }) // 3
log({ n: 90, base: 10 }) // 1.954...
</code></pre>
<pre class=fragment>
<code class="lang-javascript ">
// team up with required!
function log({ n = required(&quot;n&quot;), base = required(&quot;base&quot;) }) {
  return Math.log(n) / Math.log(base);
}

function required(name) {
  throw new Error(name + &quot; is a required argument&quot;);
}
</code></pre>


</section>

<section  class=""><h2 id="named-parameters-defaults">Named parameters defaults</h2>
<pre><code class="lang-javascript">function log({ n, base = 2 }) {
  return Math.log(n) / Math.log(base);
}


console.log(log({ n: 8 })) // 3
log() // TypeError: Cannot match against &#39;undefined&#39; or &#39;null&#39;

// How to fix?
</code></pre>
</section>

<section  class=""><h2 id="complete-named-parameters">Complete named parameters</h2>
<pre><code class="lang-javascript">function log({ n, base = 2 } = {}) {
  return Math.log(n) / Math.log(base);
}


console.log(log({ n: 8 })) // 3
log() // NaN
</code></pre>
</section>

<section  class=""><h2 id="variable-length">Variable length</h2>
<pre><code class="lang-javascript">// variable length functions
function sprintf(format, ...args) {
  console.log(format, ...args);
}

const pair = [1,2];

// can use ... in calls too!
sprint(&quot;%s %s&quot;, ...pair);
</code></pre>
</section>

<section  class=""><h2 id="calling-with-spread">Calling with spread</h2>
<pre><code class="lang-javascript">const things = [&#39;🏆&#39;,&#39;🎨&#39;];

// 🏆 🎨 🚀
console.log(...things, &#39;🚀&#39;);

// 🚀 🏆 🎨
console.log(&#39;🚀&#39;, ...things);
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="exercise-">Exercise!</h2>
<pre><code>exercises/functions-core
</code></pre></section>

<section data-state='title' class=" title"><h2 id="closures">Closures</h2>
</section>

<section  class=""><h2 id="functions-retain-context">Functions retain context</h2>
<ul>
<li>functions retain variables visible where they&#39;re defined</li>
</ul>
</section>

<section  class=""><h2 id="in-detail">In detail</h2>
<ul>
<li>functions see var/let/const in surrounding function</li>
<li>this link remains long after surrounding fn clears</li>
</ul>
</section>

<section  class=""><h2 id="-"> </h2>
<p><img src="media/closures annotated.png"></p>
</section>

<section data-state='notitle' class=" notitle"><h2 id="context">Context</h2>
<p>We can see variables in functions that wrap us (red)</p>
<p><img src="media/closures annotated.png"></p>
</section>

<section data-state='notitle' class=" notitle"><h2 id="privacy">Privacy</h2>
<p>We can&#39;t see variables from inner functions (blue)</p>
<p><img src="media/closures annotated.png"></p>
</section>

<section  class=""><h2 id="coding-interview-spoiler">Coding interview spoiler</h2>
<pre><code class="lang-javascript">var elements = document.querySelectorAll(&quot;button&quot;);

// What is wrong here? How can we solve?
for(var i = 0; i &lt; elements.length; i++) {
  var element = elements[i];
  element.addEventListener(&quot;click&quot;, function() {
    console.log(element.innerHTML);
  });
}
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="exercise">Exercise</h2>
<pre><code>exercise/closures
</code></pre></section>

<section data-state='title' class=" title"><h2 id="object-system">Object system</h2>
</section>

<section  class=""><h2 id="object-system-is-ubiquitous">Object system is ubiquitous</h2>
</section>

<section  class=""><h2 id="understanding-how-it-works-is-vital">Understanding how it works is vital</h2>
</section>

<section  class=""><h2 id="what-are-js-objects-">What are JS objects?</h2>
</section>

<section  class=""><h2 id="well-">Well...</h2>
</section>

<section  class=""><h2 id="everything-not-null-or-undefined">Everything not null or undefined</h2>
</section>

<section  class=""><h2 id="e-g">e.g</h2>
<pre><code class="lang-javascript">const thingsYouMightNotFeelAreObjects = [
    true,
    false,
    0,
    Infinity,
    NaN,
    / /,
    [],
];

// true &quot;true&quot; ƒ Boolean() { [native code] }
// false &quot;false&quot; ƒ Boolean() { [native code] }
// 0 &quot;0&quot; ƒ Number() { [native code] }
// Infinity &quot;Infinity&quot; ƒ Number() { [native code] }
// NaN &quot;NaN&quot; ƒ Number() { [native code] }
// / / &quot;/ /&quot; ƒ RegExp() { [native code] }
// [] &quot;&quot; ƒ Array() { [native code] }
for(const thing in thingsYouMightNotFeelAreObjects) {
    console.log(thing, thing.toString(), thing.constructor);
}
</code></pre>
</section>

<section  class=""><h2 id="objects">Objects</h2>
<ul>
<li>Objects have properties</li>
<li>Interact with via <code>.</code> or <code>[]</code>, <code>in</code> and <code>delete</code></li>
</ul>
</section>

<section  class=""><h2 id="quiz">Quiz</h2>
<pre><code class="lang-javascript">const a = {};
a[1] = &#39;🐷&#39;;
a[&#39;1&#39;] = &#39;🐢&#39;;

console.log(a); // ?
</code></pre>
</section>

<section  class=""><h2 id="object-literal-dynamic-key">Object literal - dynamic key</h2>
<pre><code class="lang-javascript">function kv(key, value) {
    return {[key]: value};
}

// {whale: &#39;🐳&#39;}
console.log(kv(&#39;whale&#39;, &#39;🐳&#39;))
</code></pre>
</section>

<section  class=""><h2 id="keys-are-mostly-strings">Keys are mostly strings</h2>
</section>

<section  class=""><h2 id="non-string-keys-get-converted-to-strings">Non-string keys get converted to strings</h2>
</section>

<section  class=""><h2 id="-mostly-">...mostly?</h2>
<ul>
<li>What else?</li>
</ul>
</section>

<section  class=""><h2 id="symbols">Symbols</h2>
</section>

<section  class=""><h2 id="best-explanation-why">Best explanation: why</h2>
</section>

<section  class=""><h2 id="safe-language-extensibility">Safe language extensibility</h2>
<ul>
<li>avoid the Mootools/Prototype.js woe</li>
</ul>
<pre><code class="lang-javascript">// some library
if(!(&#39;contains&#39; in String.prototype)) {
    String.prototype.contains = containsPolyfill;
}
</code></pre>
</section>

<section  class=""><h2 id="why-">Why?</h2>
<ul>
<li>anything else that&#39;s a key in an object is a string</li>
<li>anyone can define any string, so you&#39;ll get clashes</li>
</ul>
</section>

<section  class=""><h2 id="how-">How?</h2>
</section>

<section  class=""><h2 id="a-symbol-is-unique-and-only-equal-to-itself">A symbol is unique, and only equal to itself</h2>
<pre><code class="lang-javascript">const a = Symbol();
const b = Symbol();
console.log(a === b) // false

// given a name, will show up in string representation,
// no change in behaviour
console.log(Symbol(&#39;hat&#39;) === Symbol(&#39;hat&#39;)) // false
</code></pre>
</section>

<section  class=""><h2 id="a-symbol-is-unique-and-only-equal-to-itself">A symbol is unique, and only equal to itself</h2>
<pre><code class="lang-javascript">console.log(Symbol(&#39;hat&#39;) === Symbol(&#39;hat&#39;)) // false
const hat = Symbol(&#39;hat&#39;);

const a = {};
a[hat] = &#39;🎩&#39;;

console.log(a[Symbol(&#39;hat&#39;)], a.hat); // ?
</code></pre>
</section>

<section  class=""><h2 id="safe-">Safe!</h2>
<pre><code class="lang-javascript">// browser.js
const browserCoolMethod = Symbol(&#39;coolMethod&#39;);
String.prototype[browserCoolMethod] = () =&gt; {
    // standard library implementation
};

// library.js
const coolMethod = Symbol(&#39;coolMethod&#39;);

if(!(coolMethod in String.prototype)) {
    String.prototype[coolMethod] = () =&gt; {};
}

console.log(
    String.prototype[browserCoolMethod]
    === String.prototype[coolMethod]
); // false
</code></pre>
</section>

<section  class=""><h2 id="shared-symbols">Shared symbols</h2>
<pre><code class="lang-javascript">// uses global symbol repository
Symbol.for(&#39;egg&#39;) === Symbol.for(&#39;egg&#39;);

// useful for?
</code></pre>
</section>

<section  class=""><h2 id="could-symbols-be-useful-for-anything-else-">Could symbols be useful for anything else?</h2>
</section>

<section  class=""><h2 id="not-privacy-">Not privacy! :)</h2>
<pre><code class="lang-javascript">// [Symbol(Symbol.iterator), Symbol(Symbol.unscopables)]
console.log(Object.getOwnPropertySymbols(Array.prototype));
// &quot;symbol&quot;
console.log(typeof Object.getOwnPropertySymbols(Array.prototype)[0])
</code></pre>
</section>

<section  class=""><h2 id="tip-don-t-use-symbols-in-application-code">Tip: don&#39;t use symbols in application code</h2>
</section>

<section  class=""><h2 id="maybe-in-your-own-libraries-">Maybe in your own libraries...</h2>
<ul>
<li>possibly sign you&#39;re doing something un-Javascripty though?</li>
<li>overeaching, Ruby style extension to objects</li>
</ul>
</section>

<section  class=""><h2 id="where-do-methods-come-from-">Where do methods come from?</h2>
<pre><code class="lang-javascript">const animals = [&#39;🐢&#39;, &#39;🐳&#39;, &#39;🐫&#39;];
// what happens here?
console.log(animals.slice(-2));
</code></pre>
</section>

<section  class=""><h2 id="reason-about-property-lookup">Reason about property lookup</h2>
<pre><code class="lang-javascript">const animals = [&#39;🐢&#39;, &#39;🐳&#39;, &#39;🐫&#39;];
// ok, is there a &#39;slice&#39; in the array instance?
animals.hasOwnProperty(&#39;slice&#39;); // false
</code></pre>
</section>

<section  class=""><h2 id="what-happens-next-">What happens next?</h2>
</section>

<section  class=""><h2 id="reason-about-property-lookup">Reason about property lookup</h2>
<pre><code class="lang-javascript">const animals = [&#39;🐢&#39;, &#39;🐳&#39;, &#39;🐫&#39;];
// ok, is there a &#39;slice&#39; in the array instance?
animals.hasOwnProperty(&#39;slice&#39;); // false

// what about in the prototype?
z.<strong>proto</strong>.hasOwnProperty(&#39;slice&#39;) // true
</code></pre>
</section>

<section  class=""><h2 id="lookup-algorithm">Lookup algorithm</h2>
<pre><code class="lang-javascript">// always at run-time
function getProperty(object, prop) {
  if(object.hasOwnProperty(prop)) {
    return object[prop];
  } else {
    if(object.__proto__) {
      getProperty(object.__proto__, prop);
    } else {
      return undefined;
    }
  }
}
</code></pre>
</section>

<section  class=""><h2 id="happens-however-the-lookup-occurs">Happens however the lookup occurs</h2>
<pre><code class="lang-javascript">someObject.someProperty;
someObject[&#39;someProperty&#39;];
const prop = someProperty;
someProperty[prop];
</code></pre>
</section>

<section  class=""><h2 id="other-lookups">Other lookups</h2>
<pre><code class="lang-javascript">const hasKeyOrPrototypeHasKey = &#39;x&#39; in someObject;

// only affects the object itself
delete someObject.x;
</code></pre>
</section>

<section  class=""><h2 id="what-happens-if-">What happens if...</h2>
<pre><code class="lang-javascript">const arrayOne = [1,2];
const arrayTwo = [4,7];

arrayOne.slice = () =&gt; { throw Error(&#39;hi&#39;) };

// what happens here?
arrayTwo.slice(-1);
</code></pre>
</section>

<section  class=""><h2 id="because">Because</h2>
<ul>
<li>assignment/delete affects instance</li>
<li>prototype is unaffected!</li>
</ul>
</section>

<section data-state='title' class=" title"><h2 id="oop">OOP</h2>
</section>

<section  class=""><h2 id="oop-in-js">OOP in JS</h2>
<ul>
<li>ES6: <code>class</code></li>
<li>ES5: prototypes</li>
</ul>
</section>

<section  class=""><h2 id="es6">ES6</h2>
<pre><code class="lang-javascript">class Widget {
  constructor({ model }) {
    this._model = model;
  }

  render() {
    return `&lt;div&gt;${ this._model.get(&quot;name&quot;) }&lt;/div&gt;`;
  }
}

const instance = new Widget({
  model: new Map([[&quot;name&quot;, &quot;crockford&quot;]]),
});
</code></pre>
</section>

<section  class=""><h2 id="let-s-break-it-down">Let&#39;s break it down</h2>
<pre><code class="lang-javascript">class Widget {
  // this is the function invoked when we call &#39;new Widget&#39;
  constructor({ model }) {
    // ... 
  }
}
</code></pre>
</section>

<section  class=""><h2 id="let-s-break-it-down">Let&#39;s break it down</h2>
<pre><code class="lang-javascript">class Widget {
  // ...

  // methods defined here will be callable on the instances
  render() {

  }
}
</code></pre>
</section>

<section  class=""><h2 id="let-s-have-a-go">Let&#39;s have a go</h2>
<pre><code>Exercise 1

exericses/objects-and-prototypes
</code></pre></section>

<section  class=""><h2 id="okay-that-s-the-basics">Okay that&#39;s the basics</h2>
</section>

<section  class=""><h2 id="what-about">What about</h2>
</section>

<section  class=""><h2 id="privacy-">Privacy?</h2>
</section>

<section  class=""><h2 id="consensual-privacy">Consensual privacy</h2>
<pre><code class="lang-javascript">class Widget {

  render() {
    return `&lt;div&gt;${ this._renderName() }&lt;/div&gt;`;
  }

  // prefix to show it&#39;s private
  _renderHelper() {
    return `&lt;span class=&#39;name&#39;&gt;
      ${ this._model.get(&quot;name&quot;) }
    &lt;/span&gt;`;
  }

}

const instance = new Widget(/* ... */);

instance.render();
instance._renderHelper(); // no error
</code></pre>
</section>

<section  class=""><h2 id="stricter-privacy">Stricter privacy</h2>
<pre><code class="lang-javascript">const privates = new WeakMap;

class Counter {
  constructor() {
    privates.set(this, { count: 0 })
  }

  get() {
    return privates.get(this).count;
  }

  add() {
    privates.get(this).count += 1;
  }
}

const instance = new Counter(/* ... */);

instance.add();
instance.add();
console.log(instance.get()); // 2
</code></pre>
</section>

<section  class=""><h2 id="-weakmap-"><code>WeakMap</code>?</h2>
<ul>
<li><em>keys</em> are available to garbage collect (GC)</li>
<li>if only weak references remain, available for GC</li>
<li>keys must be non-primitives</li>
</ul>
</section>

<section  class=""><h2 id="-weakmap-e-g"><code>WeakMap</code> e.g</h2>
<pre><code class="lang-javascript">const map = new Map;
const weak = new WeakMap;

const A = {};
const B = {};
const C = {};

map.set(A, &quot;&quot;);
weak.set(B, &quot;&quot;);

weak.set(B, &quot;&quot;);
weak.set(C, &quot;&quot;);

global.map = map;
global.weak = weak;
</code></pre>
</section>

<section  class=""><h2 id="inheritence">Inheritence</h2>
<pre><code class="lang-javascript">class DefaultMap extends Map {

  constructor(members, defaulter) {
    super(members);
    this._default = defaulter;
  }

  get(key) {
    if(!this.has(key)) {
      this._default(key, this);<br>    }

    return super.get(key);
  }
}

const instance = new DefaultMap([[&quot;apples&quot;, 7 ]]), 
  () =&gt; 0)

console.log(instance.get(&quot;apples&quot;)) // 7
console.log(instance.get(&quot;pears&quot;)) // 0
</code></pre>
</section>

<section  class=""><h2 id="broken-down">Broken down</h2>
<pre><code class="lang-javascript">class DefaultMap extends Map {

  constructor(members, default) {
    super(members);
    this._default = default;
  }

  // ...
}
</code></pre>
<pre><code class="lang-javascript">// this is the default constructor of a sub-class
constructor(...args) {
  super(...args)
}
</code></pre>
</section>

<section  class=""><h2 id="calling-super-methods">Calling super methods</h2>
<pre><code class="lang-javascript">class DefaultMap extends Map {
  // ...

  get(key) {
    // ...

    return super.get(key);
  }
}
</code></pre>
</section>

<section  class=""><h2 id="let-s-try">Let&#39;s try</h2>
<pre><code>Exercise 2

exercises/objects-and-prototypes
</code></pre></section>

<section  class=""><h2 id="properties-">Properties?</h2>
<pre><code class="lang-javascript">class Widget {
  something: [];
}
</code></pre>
</section>

<section data-state='bad' class=" bad"><h2 id="nope">Nope</h2>
</section>

<section  class=""><h2 id="deliberate-ommission">Deliberate ommission</h2>
</section>

<section  class=""><h2 id="instead">Instead</h2>
<pre><code class="lang-javascript">class Point {
  constructor(x, y) {
    this.x = x;
    this.y = y;
  }
}
</code></pre>
</section>

<section  class=""><h2 id="why-">Why?</h2>
</section>

<section  class=""><h2 id="well-">Well...</h2>
</section>

<section  class=""><h2 id="how-do-js-objects-really-work-">How do JS objects really work?</h2>
</section>

<section  class=""><h2 id="prototypes-">Prototypes!</h2>
</section>

<section  class=""><h2 id="big-idea">Big idea</h2>
</section>

<section  class=""><h2 id="if-an-object-doesn-t-know-it-asks-its-prototype">If an object doesn&#39;t know, it asks its prototype</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="-"> </h2>
<p><img src="media/prototypes.png"></p>
<!-- TODO explain why on image - i.e that we're reducing repetition -->
</section>

<section  class=""><h2 id="chain">Chain</h2>
<p><img src="media/prototype-chain.png"></p>
</section>

<section  class=""><h2 id="lookup-algorithm">Lookup algorithm</h2>
<pre><code class="lang-javascript">// always at run-time
function getProperty(object, prop) {
  if(object.hasOwnProperty(prop)) {
    return object[prop];
  } else {
    if(object.__proto__) {
      getProperty(object.__proto__, prop);
    } else {
      return undefined;
    }
  }
}
</code></pre>
</section>

<section  class=""><h2 id="so-properties">So... properties</h2>
<pre><code class="lang-javascript">class Widget {
}

// I&#39;m bored of initialising in constructor!
Widget.prototype.letters = [];

const A = new Widget;
const B = new Widget;
A.letters.push(&quot;a&quot;);

console.log(B.letters) // [&quot;a&quot;]
</code></pre>
<ul>
  <li>What went wrong?</li>
  <li class=fragment>All instances share same prototype property!</li>
</ul>

</section>

<section  class=""><h2 id="creating-objects-with-prototype">Creating objects with prototype</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="-"> </h2>
<pre><code class="lang-javascript">const sturcture = {
  squareArea: function() {
    return this.width * this.height;
  },
};

const house = Object.create(structure);
Object.assign(house, {
  width: 5,
  height: 10,
});

const shed = Object.create(structure);
Object.assign(shed, {
  width: 2,
  height: 2,
});

house.squareArea() // 50
shed.squareArea() // 4
</code></pre>
</section>

<section  class=""><h2 id="-this-on-invocation"><code>this</code> on invocation</h2>
<pre><code class="lang-javascript">const sturcture = {
  squareArea: function() {
    return this.width * this.height;
  },
};

const house = Object.create(structure);
Object.assign(house, {
  width: 5,
  height: 10,
});

house.squareArea() // 50
</code></pre>
</section>

<section  class=""><h2 id="magic-argument-this-">Magic argument <code>this</code></h2>
<pre><code class="lang-javascript">// this = someObject
someObject.someProperty();

const someProperty = this.someObject;

// this = enclosing this, likely global
someProperty();
</code></pre>
</section>

<section  class=""><h2 id="classic-bug">Classic bug</h2>
<pre><code class="lang-javascript">var someObject = {
  name: &quot;lil&#39; listeny&quot;,
  listen: function(el) {
    el.addEventListener(&quot;click&quot;, this.handle)
  },
  handle: function() {
    console.log(this.name);
  },
};

// what do we see console.log&#39;d?
someObject.listen(button);
button.click();
</code></pre>
</section>

<section  class=""><h2 id="how-can-we-fix-">How can we fix?</h2>
</section>

<section  class=""><h2 id="-"><code>=&gt;</code></h2>
<pre><code class="lang-javascript">var someObject = {
  // ...
  listen: function(el) {
    // fat arrow has lexical this! i.e this of current scope
    el.addEventListener(&quot;click&quot;, (e) =&gt; this.handle(e))
  },
  // ...
};
</code></pre>
</section>

<section  class=""><h2 id="-fn-bind-thisvalue-"><code>fn.bind(thisValue)</code></h2>
<pre><code class="lang-javascript">var someObject = {
  // ...
  listen: function(el) {
    // .bind returns a new fn, as if bound to this via closure
    el.addEventListener(&quot;click&quot;, this.handle.bind(this))
  },
  // ...
};
</code></pre>
</section>

<section  class=""><h2 id="writing-bind-">Writing <code>bind</code></h2>
<pre><code class="lang-javascript">function bind(fn, thisValue) {
  return function() {
    return fn.apply(thisValue, arguments);
  }
}
</code></pre>
</section>

<section data-state='notitle' class=" notitle"><h2 id="via-new-">Via <code>new</code></h2>
<pre><code class="lang-javascript">function Structure(width, height) {
  this.width = width;
  this.height = height;
}

Structure.prototype = {
  squareArea: function() {
    return this.width * this.height;
  },
};

function House(w, h, bedrooms) {
  Structure.call(this, w, h);
  this.bedrooms = bedrooms;
}

House.prototype = new Structure;
House.prototype.sleeps = function() {
  return this.bedrooms.reduce((s,b) =&gt; s + b.sleeps, 0)
};
</code></pre>
</section>

<section  class=""><h2 id="-call-thisvalue-args-"><code>.call(thisValue, ...args)</code></h2>
<pre><code class="lang-javascript">function House(w, h, bedrooms) {
  Structure.call(this, w, h);
  this.bedrooms = bedrooms;
}


function Structure(width, height) {
  // our &#39;this&#39; value when we call Structure.call above
  // will be an object { <strong>proto</strong>: House.prototype }
  this.width = width;
}
</code></pre>
</section>

<section  class=""><h2 id="let-s-try-">Let&#39;s try!</h2>
<pre><code>Exercise 3

exercises/objects-and-prototypes
</code></pre></section>

<section data-state='title' class=" title"><h2 id="solving-problems-with-data-structures">Solving problems with data structures</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="choose-the-right-data-structure">Choose the right data structure</h2>
<blockquote>
<p>Bad programmers worry about the code. Good programmers worry about data structures and their relationships</p>
</blockquote>
<p>Linus Torvalds</p>
</section>

<section  class=""><h2 id="why-">Why?</h2>
<ul>
<li>brevity</li>
<li>performance</li>
<li>language independent</li>
</ul>
</section>

<section  class=""><h2 id="example-problems">Example problems</h2>
<ul>
<li>tracking items</li>
<li>queues</li>
<li>lookups</li>
<li>filtering</li>
</ul>
</section>

<section data-state='title' class=" title"><h2 id="ordered-data-structures">Ordered data-structures</h2>
</section>

<section  class=""><h2 id="-array-"><code>Array</code></h2>
</section>

<section  class=""><h2 id="for-ordered-data">For ordered data</h2>
<!-- TODO lookup some nice order-dependent challenges -->
</section>

<section  class=""><h2 id="ordered">Ordered</h2>
<pre><code class="lang-script">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

primeMinisters[0] // What would this be?

// ...and this?
primeMinisters[primeMinisters.length - 1] 

// ...and this?
primeMinisters[-1] 

console.log(primeMinisters.length) // 4
</code></pre>
<ul>
  <li class=fragment>Cameron - Array is 0 indexed</li>
  <li class=fragment>Major</li>
  <li class=fragment>undefined - negative indexes not defined</li>
</ul>

</section>

<section  class=""><h2 id="extension">Extension</h2>
<pre><code class="lang-script">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

primeMinisters.unshift(&quot;Fry&quot;); // at start
primeMinisters.push(&quot;Thatcher&quot;); // at end


// what did we learn about const?
console.log(primeMinisters.length) // 6

primeMinisters.pop(); // drops end
primeMinisters.shift(); // drops start

console.log(primeMinisters.length) // 4
</code></pre>
</section>

<section  class=""><h2 id="subsets">Subsets</h2>
<pre><code class="lang-script">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

const lastLabourGovernment = primeMinisters.slice(1, 3);

 // Blair then Brown
lastLabourGovernment.reverse().join(&quot; then &quot;)

// how does slice() work?
</code></pre>
</section>

<section  class=""><h2 id="sorting">Sorting</h2>
<pre><code class="lang-javascript">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

primeMinisters.sort();


// [ &#39;Blair&#39;, &#39;Brown&#39;, &#39;Cameron&#39;, &#39;Major&#39; ]
console.log(primeMinisters)

// what can we tell about .sort() and mutation?

// and sort order?
primeMinisters.sort((a,b) =&gt; a.length - b.length)

// [ &#39;Blair&#39;, &#39;Brown&#39;, &#39;Major&#39;, &#39;Cameron&#39; ]
console.log(primeMinisters)
</code></pre>
</section>

<section  class=""><h2 id="-for-in-"><code>for ... in</code></h2>
<pre><code class="lang-javascript">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

// what... is this allowed?
primeMinisters.metaData = &quot;hi&quot;;

// for ... in will go over all properties of arrays
var initials = [];
for(let i in primeMinisters) {
  initials.push( primeMinisters[i][0] );
}

// what does initials end up as?
</code></pre>
<ul>
  <li class=fragment>C, B, B, M, h. Why?</li>
  <li class=fragment><code>Array</code> can have string properties!</li>
  <li class=fragment><code>for .. in</code> iterates string properties</li>
</ul>


</section>

<section  class=""><h2 id="-for-"><code>for</code></h2>
<pre><code class="lang-javascript">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

const initials = [];
for(let i = 0, l = primeMinisters.length; i &lt; l; i++) {
  initials[i] = primeMinisters[i][0];
}
</code></pre>
<ul>
<li>likely always fastest</li>
<li>but: ugly. Use <em>only</em> when forced to</li>
<li>your time is much, much more valuable :)</li>
</ul>
</section>

<section  class=""><h2 id="-for-of-"><code>for .. of</code></h2>
<pre><code class="lang-javascript">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];
primeMinisters.metaData = &quot;hi&quot;;

// ES6 `for ... of` goes over VALUES of iterables
const initials = [];
for(let pm of primeMinisters) {
  initials.push(pm[0]);
}

console.log(initials) // [&quot;C&quot;,&quot;B&quot;,&quot;B&quot;,&quot;M&quot;]
</code></pre>
<ul>
<li>What problem is solved?</li>
</ul>
</section>

<section  class=""><h2 id="rule-avoid-for-in-on-arrays">Rule: avoid <code>for ... in</code> on arrays</h2>
</section>

<section  class=""><h2 id="functional-iteration">Functional iteration</h2>
<pre><code class="lang-javascript">// ES5 &#39;array additions&#39;
const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

primeMinisters.filter((p) =&gt; p[0] === &quot;B&quot;) // [&quot;Brown&quot;,&quot;Blair&quot;];

primeMinisters.map((p) =&gt; p[0]) // [ &quot;C&quot;, &quot;B&quot;, &quot;B&quot;, &quot;M&quot; ]

primeMinisters.reduce((s, e) =&gt; s + &quot;:&quot; + e) // &#39;Cameron:Brown:Blair:Major&#39;
</code></pre>
</section>

<section  class=""><h2 id="functional-iterators">Functional iterators</h2>
<ul>
<li>intention revealing</li>
<li>shorter, less error-prone</li>
</ul>
</section>

<section  class=""><h2 id="remember-compares-by-identity">Remember: compares by identity</h2>
<pre><code class="lang-javascript">const byValue = [1,2] === [1,2]; // false

const couldStringify = JSON.stringify([1,2]) 
  === JSON.stringify([1,2]); // true
</code></pre>
</section>

<section  class=""><h2 id="exercise">Exercise</h2>
<pre><code>exercises/arrays
</code></pre></section>

<section data-state='title' class=" title"><h2 id="key-value-data-structures">Key-value data-structures</h2>
</section>

<section  class=""><h2 id="we-use-a-key-value-data-structure-constantly-in-js">We use a key/value data-structure constantly in JS</h2>
</section>

<section  class=""><h2 id="which-is-">Which is...?</h2>
</section>

<section  class=""><h2 id="object">Object</h2>
</section>

<section  class=""><h2 id="a-plain-object-is-a-great-key-value-data-structure">A plain object is a great key/value data-structure</h2>
<ul>
<li>AKA dictionary, hashmap, associative array, table</li>
</ul>
</section>

<section  class=""><h2 id="-object-used-as-dictionary"><code>Object</code> used as dictionary</h2>
<pre><code class="lang-javascript">const enToFr = {};

enToFr.hello = &quot;bonjour&quot;;
enToFr.cheese = &quot;fromage&quot;;

// equivalent
console.log(enToFr.hello);
console.log(enToFr[&quot;hello&quot;]);
</code></pre>
</section>

<section  class=""><h2 id="most-important-place-we-ll-use-objects-as-kv-data-structures-">Most important place we&#39;ll use objects as KV data-structures?</h2>
</section>

<section  class=""><h2 id="the-most-popular-data-interchange-format-in-the-world-is-">The most popular data-interchange format in the world is...?</h2>
</section>

<section  class=""><h2 id="json">JSON</h2>
<p>JavaScript Object Notation</p>
<p><img src="media/json-spec.png" alt="json spec fits on card"></p>
</section>

<section  class=""><h2 id="building-block-of-json">Building block of JSON</h2>
<pre><code class="lang-javascript">{
    &quot;goal&quot;: &quot;structuring data&quot;,
    &quot;how&quot;: &quot;associating values with keys, or position in arrays&quot;,
    &quot;attributes&quot;: [
        &quot;simple&quot;,
        &quot;human readable&quot;,
        &quot;human writable&quot;
    ]
}
</code></pre>
</section>

<section  class=""><h2 id="keys-are-strings-values-any">Keys are strings, values = any</h2>
<pre><code class="lang-javascript">const dict = {};

dict[10] = &quot;ten&quot;;

console.log(dict[&quot;10&quot;]); // &quot;ten&quot;

// general rule: calls toString on non-strings
const convertsToTen = {
  toString: () =&gt; &quot;10&quot;
};

console.log(dict[convertsToTen]); // &quot;ten&quot;
</code></pre>
</section>

<section  class=""><h2 id="iterating-objects">Iterating objects</h2>
</section>

<section  class=""><h2 id="-for-in-"><code>for ... in</code></h2>
<pre><code class="lang-javascript">for(const property in Object.values(object)) {
  const value = object[property];
  console.log(`${property}: ${value}`);
}
</code></pre>
</section>

<section  class=""><h2 id="-for-of-"><code>for ... of</code></h2>
<pre><code class="lang-javascript">// objects not iterable by default, so...
for(const [property, value] of entries(object)) {
  console.log(`${property}: ${value}`);
}

// Object.entries(obj) is ES2017
</code></pre>
</section>

<section  class=""><h2 id="es6-dynamic-keys">ES6 - dynamic keys</h2>
<pre><code class="lang-javascript">// ES6
function create(property, value) {
  return { [&quot;id:&quot; + property]: value };
}

// ES5
function create(property, value) {
  var o = {};
  o[&quot;id:&quot; + property] = value;
  return o;
}
</code></pre>
</section>

<section  class=""><h2 id="missing-features">Missing features</h2>
<pre><code class="lang-javascript">const dict = {};

dict[1] = &quot;hello&quot;;

// how to count?
console.log(dict.length); // undefined

console.log(Object.keys(dict).length); // slow for very large objects
</code></pre>
</section>

<section  class=""><h2 id="es6-to-the-rescue-">ES6 to the rescue!</h2>
<pre><code class="lang-javascript">const m = new Map;
const o = {};

const a = [1,2];
const b = [1,2];

// assign
m.set(a, &quot;A&quot;);
m.set(b, &quot;B&quot;);

o = {[a]: &quot;A&quot;, [b]: &quot;B&quot;}

console.log(Object.keys(o).length); // 1
console.log(m.size); // 2

// ...why?
</code></pre>
</section>

<section  class=""><h2 id="more-map-">More <code>Map</code></h2>
<pre><code class="lang-javascript">const m = new Map;

const list = [1,2,3];

m.set(list, &quot;A&quot;);
console.log(m.get(list)); // A

console.log(m.get([1,2,3])); // ...?

const m2 = new Map([
  [&quot;list&quot;, &quot;hello&quot;],
  [&quot;boo&quot;, &quot;another key&quot;],
]);
</code></pre>
</section>

<section  class=""><h2 id="maps-for-of-">Maps: <code>for .. of</code></h2>
<pre><code class="lang-javascript">const m = new Map;
m.set(&quot;A&quot;, 1);
m.set(&quot;B&quot;, 2);

for(const prop in m) {
  console.log(prop) // not called! why?
}

for(const kv of m) {
  console.log(kv) // [&quot;A&quot;, 1], ...
}

for(const k of m.keys()) {
  console.log(k) // &quot;A&quot;, &quot;B&quot;
}

for(const v of m.values()) {
  console.log(v) // 1, 2
}

m.forEach((v, k) =&gt; console.log(v, k))
</code></pre>
</section>

<section  class=""><h2 id="-set-"><code>Set</code></h2>
<pre><code class="lang-javascript">// ES6 only

const s = new Set;

s.add(1);
console.log(s.has(1)); // ...?

console.log(s.size); // ...?
s.add(1); s.add(1); s.add(1);
console.log(s.size); // ...?

const A = [1,2];
s.add(A);

console.log(s.has(A)); // ...?
console.log(s.has([1,2])); // ...?
</code></pre>
</section>

<section  class=""><h2 id="exercise">Exercise</h2>
<pre><code>exercises/maps-objects-sets
</code></pre></section>

<section data-state='title' class=" title"><h2 id="async">Async</h2>
</section>

<section  class=""><h2 id="async-io">Async IO</h2>
<ul>
<li>ubiquitious in JS</li>
<li>the ecosystem default</li>
<li>vs subset of libraries in Ruby EM, Python Twisted</li>
</ul>
</section>

<section  class=""><h2 id="let-s-compare">Let&#39;s compare</h2>
</section>

<section  class=""><h2 id="synchronous-io">Synchronous IO</h2>
<ul>
<li>AKA &#39;blocking IO&#39;</li>
</ul>
<pre><code class="lang-javascript">1 // we&#39;ll not continue to the next line until the OS
2 // has read the file and provided it back to our process
3 var contents = fs.readFileSync(&quot;/tmp/hello&quot;, &quot;utf8&quot;);
4 
5 console.log(&quot;End of source file&quot;);
</code></pre>
</section>

<section  class=""><h2 id="asynchronous-io">Asynchronous IO</h2>
<ul>
<li>AKA &#39;non-blocking IO&#39;</li>
</ul>
<pre><code class="lang-javascript">1 fs.readFile(&quot;/tmp/hello&quot;, { encoding: &quot;utf8&quot; },
2  function(err, content) {
3    // (2/2) ...we get here
4    console.log(&quot;Read the file&quot;);
5  });
6
7 // (1/2) we&#39;ll get here waaaaaaaaaaaay before...
8 console.log(&quot;End of source file&quot;);
</code></pre>
</section>

<section  class=""><h2 id="clearing-the-stack">Clearing the stack</h2>
<ul>
<li>no code ever runs simultaneously</li>
<li>while code is running, no callbacks fire</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-loop">Diagram loop</h2>
<p><img src="media/event-loop-schematic.png"></p>
</section>

<section  class=""><h2 id="rule-don-t-block-the-loop">Rule: don&#39;t block the loop</h2>
<ul>
<li>avoid long running, synchronous code</li>
<li>chunk</li>
<li>or delegate to other processes/WebWorkers</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-starving-the-lop">Diagram: starving the lop</h2>
<p><img src="media/event-loop.png"></p>
</section>

<section  class=""><h2 id="sources-of-async">Sources of async</h2>
<ul>
<li><code>setTimeout</code></li>
<li>AJAX</li>
<li>IndexedDB, WebWorkers</li>
<li>most Node APIs (<code>fs</code>, <code>child_process</code>)</li>
</ul>
</section>

<section  class=""><h2 id="stacks">Stacks</h2>
<ul>
<li>languages with functions need a stack</li>
<li>keeps point to return to</li>
<li>stack &#39;unravels&#39; with errors</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="stack">Stack</h2>
<p><img src="media/stacks.png"></p>
</section>

<section  class=""><h2 id="-try-catch-"><code>try ... catch</code></h2>
<ul>
<li>JS looks back up the (sync) stack on errors</li>
<li>if we&#39;re inside a <code>try ... catch</code> in the stack, we&#39;re ok</li>
</ul>
</section>

<section  class=""><h2 id="try-catch">try + catch</h2>
<pre><code class="lang-javascript">function main() {
  try {
    helper();
  } catch(e) {
    console.log(e);
  }

}

function helper() {
  throw Error(&quot;bad thing&quot;);
}
</code></pre>
</section>

<section data-state='notitle' class=" notitle"><h2 id="-"> </h2>
<p><img src="media/try-catch-sync.jpg"></p>
</section>

<section  class=""><h2 id="with-async-try-catch-can-t-help-you">With async, <code>try ... catch</code> can&#39;t help you</h2>
</section>

<section  class=""><h2 id="e-g">e.g</h2>
<pre><code class="lang-javascript">function main() {
  try {
    // make a async HTTP request
    $.get(&quot;/some/json/url&quot;);
  } catch(e) {
    console.log(e);
  }
}
</code></pre>
</section>

<section data-state='notitle' class=" notitle"><h2 id="-"> </h2>
<p><img src="media/try-catch-async.jpg"></p>
</section>

<section  class=""><h2 id="let-s-try">Let&#39;s try</h2>
<pre><code>exercises/callbacks-and-async
</code></pre></section>

<section data-state='title' class=" title"><h2 id="promises">Promises</h2>
</section>

<section  class=""><h2 id="intuition">Intuition</h2>
<p><img src="media/promises.png" alt="Promise chain"></p>
</section>

<section  class=""><h2 id="an-iou">An IOU</h2>
<ul>
<li>A value, available immediately</li>
<li>Settled - resolved or rejected - once</li>
<li>Use before or after settled</li>
</ul>
</section>

<section  class=""><h2 id="promises-in-practice">Promises in practice</h2>
</section>

<section  class=""><h2 id="steps-in-process">Steps in process</h2>
<ul>
<li><code>.then(transformResolve, transformReject)</code></li>
</ul>
<pre><code class="lang-javascript">const user = getUser(params[&quot;id&quot;]);
const profile = user.then(getProfile);
const accountPage = Promise.all([user,profile])
  .then(accountPageTemplate);
</code></pre>
</section>

<section  class=""><h2 id="present-use-value">Present/use value</h2>
<ul>
<li>finally used more like callback</li>
</ul>
<pre><code class="lang-javascript">accountPage.then(
  renderHtml,
  renderErrorMessage
);
</code></pre>
</section>

<section  class=""><h2 id="-then-is"><code>then</code> is</h2>
<ul>
<li>Mostly: recipe for new values</li>
<li>Sometimes: actions when resolved</li>
</ul>
</section>

<section  class=""><h2 id="where-">Where?</h2>
<ul>
<li>ES5: libraries</li>
<li>ES6: built-in</li>
<li>Libraries actually better</li>
</ul>
</section>

<section  class=""><h2 id="promise-tools">Promise tools</h2>
</section>

<section  class=""><h2 id="creating-resolved-promise">Creating resolved promise</h2>
<pre><code class="lang-javascript">Promise.resolve(x)
</code></pre>
<ul>
<li>returns a promise, if x is:</li>
<li>a non-promise, a fulfilled promise for &#39;x&#39;</li>
<li>a promise, that promise</li>
</ul>
</section>

<section  class=""><h2 id="creating-rejected">Creating rejected</h2>
<pre><code>Promise.reject(Error(&quot;some description&quot;))
</code></pre><ul>
<li>returns a rejected promise</li>
<li>should always reject with <code>Error</code> for stacks</li>
</ul>
</section>

<section  class=""><h2 id="groups-of-promises">Groups of promises</h2>
<pre><code>Promise.all([promise, value, promiseB, valueB])
</code></pre><ul>
<li>returns promise for an array with all resolved</li>
<li>works with all iterables (<code>Array</code>, <code>Map</code> etc)</li>
</ul>
</section>

<section  class=""><h2 id="flow-control">Flow control</h2>
<pre><code class="lang-javascript">SomeQuery
  .then(transform)
  .then(function(value) {
    if(!isOk(value)) {
      return Promise.reject(Error(&quot;Not ok!&quot;))
    }

    return someTest(value)) ?
      QueryA(value) : QueryB(value);
  })
  .catch((err) =&gt; Promise.reject(Error(&quot;Query failed: &quot; + err)))
  .finally(function() {
    // anything that happens if resolved/rejected
  });
</code></pre>
</section>

<section  class=""><h2 id="rule-don-t-use-promises-as-callbacks">Rule: don&#39;t use promises as callbacks</h2>
<ul>
<li>until you&#39;re <em>doing</em> something (display etc)</li>
</ul>
</section>

<section  class=""><h2 id="promises-collections">Promises + collections</h2>
<pre><code class="lang-javascript">var userIds = [10,20,30,50,100];

// array of promises
var users = userIds.map(User.get);

// promise for array of [user, account]
var usersWithAccounts = Promise.all(users)
  .then(function(users) {
    return users.map(function(user) {
      return Promise.all([
        user,
        Account.get(user)
      ]);
    });
  });
</code></pre>
</section>

<section  class=""><h2 id="promises-conclusion">Promises conclusion</h2>
<ul>
<li>promises = values for async</li>
<li>don&#39;t just use as callbacks</li>
<li>think chains of transformations</li>
</ul>
</section>

<section  class=""><h2 id="let-s-try">Let&#39;s try</h2>
<ul>
<li>exercises/promises</li>
</ul>
</section>

<section data-state='title' class=" title"><h2 id="async-functions">Async functions</h2>
<p><!-- TODO -->## Wrap!
{title:1}</p>
</section>

<section  class=""><h2 id="thanks-">Thanks!</h2>
<p>For tips &amp; content, sign up to my mailing list:</p>
<ul>
<li><a href="http://truffles.me.uk/tips">truffles.me.uk/tips</a></li>
<li><a href="https://www.twitter.com/timruffles">@timruffles</a></li>
</ul>
</section>

</div>
</div>

<!-- demo code -->
<script src="js/jquery.js"></script>
<script src="js/lodash.js"></script>
<script src="js/angular.js"></script>

<!-- live coding -->
<script src=js/little-console.js></script>
<script src=js/showConsoles.js></script>

<!-- reveal -->
<script src="reveal/lib/js/head.min.js"></script>
<script src="reveal/plugin/highlight/highlight.js"></script>
<script src="reveal/js/reveal.js"></script>
<script src="js/revealConfig.js"></script>

</body>
